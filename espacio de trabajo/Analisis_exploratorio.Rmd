---
title: "Análisis Exploratorio de Datos"
subtitle: "Datos Combinados 2009-2022"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: 
      collapsed: false
      smooth_scroll: true
    toc_depth: 3
    number_sections: true
    theme: cosmo
    highlight: tango
    code_folding: hide
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  warning = FALSE, 
  message = FALSE,
  fig.width = 10,
  fig.height = 6,
  fig.align = 'center'
)
```

```{r librerias, include=FALSE}
# Cargar todas las librerías necesarias
library(dplyr)
library(tidyr)
library(moments)  
library(nortest)
library(ggplot2)
library(knitr)
library(kableExtra)
library(gridExtra)
library(corrplot)
library(cluster)
library(factoextra)
```

# Introducción

Este documento presenta un análisis exploratorio completo del conjunto de datos que abarca información del período 2009-2023.

## Carga de Datos

```{r cargar-datos}
datos <- read.csv("datos_combinados.csv", 
                  header = TRUE, 
                  stringsAsFactors = FALSE,
                  fileEncoding = "UTF-8")
```

::: {.alert .alert-success}
**Dataset cargado exitosamente**
:::

------------------------------------------------------------------------

# Descripción General del Conjunto de Datos

## Dimensiones del Conjunto

```{r dimensiones}
n_observaciones <- nrow(datos)
n_variables <- ncol(datos)
```

::: {.alert .alert-info}
**Resumen del Dataset:**

-   **Observaciones:** `r format(n_observaciones, big.mark = ",")` registros
-   **Variables:** `r n_variables` columnas
-   **Período:** 2009-2023
:::

## Significado y Tipo de cada Variable

### Diccionario de Datos

```{r diccionario-datos}
# Diccionario de datos - Significado de cada variable
diccionario_variables <- data.frame(
  Variable = c(
    "DEPREG", "MUPREG", "MESREG", "AÑOREG",
    "DEPOCU", "MUPOCU", "AREAG", 
    "SEXO", "DIAOCU", "MESOCU", "AÑOOCU",
    "TIPAR", "CLAPAR", "VIAPAR",
    "SEMGES", "EDADM",
    "DEPREM", "MUPREM", "GRETNM", "ESCIVM", 
    "NACIOM", "OCUPAM", "ESCOLAM",
    "PAISREM", "PUEBLOPM", "CIUOMAD", "NACIONM",
    "CAUDEF", "ASISREC", "SITIOOCU",
    "TOHITE", "TOHINM", "TOHIVI"
  ),
  Significado = c(
    "Departamento de registro",
    "Municipio de registro",
    "Mes de registro",
    "Año de registro",
    "Departamento de ocurrencia",
    "Municipio de ocurrencia",
    "Área geográfica (1=Urbana, 2=Rural)",
    "Sexo del fallecido (1=Masculino, 2=Femenino, 9=No especificado)",
    "Día de ocurrencia",
    "Mes de ocurrencia",
    "Año de ocurrencia",
    "Tipo de parto",
    "Clasificación del parto",
    "Vía del parto",
    "Semanas de gestación",
    "Edad de la madre (en años)",
    "Departamento de residencia de la madre",
    "Municipio de residencia de la madre",
    "Grupo étnico de la madre",
    "Estado civil de la madre",
    "Nacionalidad de la madre",
    "Ocupación de la madre",
    "Escolaridad de la madre (años de estudio)",
    "País de residencia de la madre",
    "Pueblo/comunidad indígena de la madre",
    "Ciudad o municipio de residencia de la madre",
    "Nacionalidad de la madre (código)",
    "Causa de defunción (código CIE-10)",
    "Asistencia recibida (1=Sí, 2=No)",
    "Sitio de ocurrencia del parto",
    "Total de hijos tenidos",
    "Total de hijos nacidos muertos",
    "Total de hijos nacidos vivos"
  ),
  stringsAsFactors = FALSE
)

diccionario_variables %>%
  kable(
    caption = "Tabla 1: Diccionario de Datos - Significado de Variables",
    col.names = c("Variable", "Descripción/Significado"),
    align = c('l', 'l')
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = TRUE,
    position = "center"
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#3498db") %>%
  scroll_box(width = "100%", height = "500px")
```

### Clasificación Estadística de Variables

```{r clasificacion-variables}
# Función para clasificar variables
clasificar_variable <- function(variable, nombre_var) {
  if(is.character(variable)) {
    return("Cualitativa - Nominal")
  }
  
  if(is.numeric(variable)) {
    valores_unicos <- length(unique(na.omit(variable)))
    total_valores <- length(na.omit(variable))
    ratio <- valores_unicos / total_valores
    
    variables_discretas <- c("SEXO", "DEPREG", "MUPREG", "MESREG", "DEPOCU", 
                             "MUPOCU", "AREAG", "TIPAR", "CLAPAR", "DEPREM",
                             "MUPREM", "GRETNM", "ESCIVM", "NACIOM", "OCUPAM",
                             "ASISREC", "SITIOOCU", "TOHITE", "TOHINM", "TOHIVI",
                             "VIAPAR", "ESCOLAM", "PAISREM", "PUEBLOPM", "NACIONM",
                             "DIAOCU", "MESOCU", "AÑOOCU", "AÑOREG")
    
    variables_continuas <- c("EDADM", "SEMGES")
    
    if(nombre_var %in% variables_discretas) {
      return("Cuantitativa - Discreta")
    } else if(nombre_var %in% variables_continuas) {
      return("Cuantitativa - Continua")
    } else {
      if(ratio < 0.05 || valores_unicos < 50) {
        return("Cuantitativa - Discreta")
      } else {
        return("Cuantitativa - Continua")
      }
    }
  }
  return("Otro")
}

# Crear tabla de información de variables
info_variables <- data.frame(
  Variable = names(datos),
  Tipo_R = sapply(datos, class),
  Clasificacion = sapply(names(datos), function(nom) {
    clasificar_variable(datos[[nom]], nom)
  }),
  Valores_Unicos = sapply(datos, function(x) length(unique(na.omit(x)))),
  Valores_NA = sapply(datos, function(x) sum(is.na(x))),
  Porcentaje_NA = round(sapply(datos, function(x) sum(is.na(x)) / length(x) * 100), 2)
)

# Mostrar tabla con formato mejorado
info_variables %>%
  kable(
    caption = "Tabla 2: Clasificación y Características de las Variables",
    col.names = c("Variable", "Tipo en R", "Clasificación Estadística", 
                  "Valores Únicos", "Valores NA", "% NA"),
    align = c('l', 'c', 'l', 'r', 'r', 'r')
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "center"
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#3498db") %>%
  scroll_box(width = "100%", height = "500px")
```

### Resumen por Tipo de Variable

```{r resumen-tipos}
resumen_tipos <- info_variables %>%
  group_by(Clasificacion) %>%
  summarise(
    Cantidad = n(),
    Porcentaje = round(n() / nrow(info_variables) * 100, 1)
  )

resumen_tipos %>%
  kable(
    caption = "Tabla 3: Distribución de Variables por Tipo",
    col.names = c("Clasificación", "Cantidad", "Porcentaje (%)"),
    align = c('l', 'r', 'r')
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE,
    position = "center"
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#2ecc71")
```

------------------------------------------------------------------------

# Exploración de Variables Numéricas

## Medidas de Tendencia Central, Distribución y Orden

```{r resumen-numericas}
vars_numericas <- names(datos)[sapply(datos, is.numeric)]

resumen_numericas <- data.frame(
  Variable = character(),
  Media = numeric(),
  Mediana = numeric(),
  Desv_Est = numeric(),
  Min = numeric(),
  Max = numeric(),
  Q1 = numeric(),
  Q3 = numeric(),
  Asimetria = numeric(),
  Curtosis = numeric(),
  stringsAsFactors = FALSE
)

for(var in vars_numericas) {
  datos_var <- datos[[var]][!is.na(datos[[var]])]
  
  if(length(datos_var) > 0) {
    resumen_numericas <- rbind(resumen_numericas, data.frame(
      Variable = var,
      Media = mean(datos_var),
      Mediana = median(datos_var),
      Desv_Est = sd(datos_var),
      Min = min(datos_var),
      Max = max(datos_var),
      Q1 = quantile(datos_var, 0.25),
      Q3 = quantile(datos_var, 0.75),
      Asimetria = skewness(datos_var),
      Curtosis = kurtosis(datos_var)
    ))
  }
}

resumen_numericas %>%
  mutate(across(where(is.numeric), ~round(., 2))) %>%
  kable(
    caption = "Tabla 4: Estadísticas Descriptivas de Variables Numéricas",
    align = c('l', rep('r', 9))
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = TRUE,
    font_size = 11
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#e74c3c") %>%
  scroll_box(width = "100%", height = "400px")
```

::: {.alert .alert-info}
**Interpretación de Medidas:**

-   **Media**: Promedio aritmético de los datos
-   **Mediana**: Valor central que divide los datos en dos partes iguales
-   **Desv. Est.**: Medida de dispersión de los datos respecto a la media
-   **Q1 y Q3**: Primer y tercer cuartil (25% y 75% de los datos)
-   **Asimetría**: Indica si la distribución es simétrica (≈0), sesgada a derecha (\>0) o izquierda (\<0)
-   **Curtosis**: Indica qué tan puntiaguda es la distribución (Normal ≈ 3)
:::

## Pruebas de Normalidad

```{r pruebas-normalidad}
pruebas_normalidad <- data.frame(
  Variable = character(),
  n = integer(),
  Shapiro_W = numeric(),
  Shapiro_pvalor = numeric(),
  KS_estadistico = numeric(),
  KS_pvalor = numeric(),
  Es_Normal = character(),
  stringsAsFactors = FALSE
)

for(var in vars_numericas) {
  datos_var <- datos[[var]][!is.na(datos[[var]])]
  n <- length(datos_var)
  
  if(n > 3) {  # Eliminamos el límite superior
    # Para datasets grandes, tomar una muestra
    if(n > 5000) {
      set.seed(123)
      datos_var <- sample(datos_var, 5000)
      n_muestra <- 5000
    } else {
      n_muestra <- n
    }
    
    shapiro_test <- shapiro.test(datos_var)
    ks_test <- ks.test(datos_var, "pnorm", mean(datos_var), sd(datos_var))
    
    es_normal <- ifelse(shapiro_test$p.value > 0.05 && ks_test$p.value > 0.05, 
                        "✓ SÍ", "✗ NO")
    
    pruebas_normalidad <- rbind(pruebas_normalidad, data.frame(
      Variable = var,
      n = n_muestra,
      Shapiro_W = shapiro_test$statistic,
      Shapiro_pvalor = shapiro_test$p.value,
      KS_estadistico = ks_test$statistic,
      KS_pvalor = ks_test$p.value,
      Es_Normal = es_normal
    ))
  }
}

pruebas_normalidad %>%
  mutate(
    Shapiro_W = round(Shapiro_W, 4),
    Shapiro_pvalor = format.pval(Shapiro_pvalor, digits = 3),
    KS_estadistico = round(KS_estadistico, 4),
    KS_pvalor = format.pval(KS_pvalor, digits = 3)
  ) %>%
  kable(
    caption = "Tabla 5: Pruebas de Normalidad (α = 0.05)",
    col.names = c("Variable", "n", "W", "p-valor", "D", "p-valor", "Normal"),
    align = c('l', 'r', 'r', 'r', 'r', 'r', 'c')
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#9b59b6") %>%
  add_header_above(c(" " = 2, "Shapiro-Wilk" = 2, "Kolmogorov-Smirnov" = 2, " " = 2)) %>%
  scroll_box(width = "100%", height = "400px")
```

::: {.alert .alert-warning}
**Interpretación:**

-   **Variables normales:** `r sum(pruebas_normalidad$Es_Normal == "✓ SÍ")` de `r nrow(pruebas_normalidad)`
-   **Variables NO normales:** `r sum(pruebas_normalidad$Es_Normal == "✗ NO")` de `r nrow(pruebas_normalidad)`

Si **p-valor \< 0.05**, rechazamos la hipótesis de normalidad. La mayoría de las variables **no siguen una distribución normal**, lo cual es común en datos de registros administrativos.
:::

## Gráficos de Normalidad {.tabset}

### Gráficos Q-Q

```{r qq-plots, fig.height=8}
vars_clave <- c("EDADM", "SEMGES", "AÑOREG", "MESREG", "SEXO")
vars_graficar <- vars_clave[vars_clave %in% vars_numericas]

par(mfrow = c(2, 3), mar = c(4, 4, 3, 1))

for(var in vars_graficar) {
  datos_var <- datos[[var]][!is.na(datos[[var]])]
  qqnorm(datos_var, main = paste("Q-Q Plot:", var), 
         col = "#3498db", pch = 20, cex = 0.5)
  qqline(datos_var, col = "#e74c3c", lwd = 2)
}

par(mfrow = c(1, 1))
```

### Histogramas

```{r histogramas, fig.height=8}
par(mfrow = c(2, 3), mar = c(4, 4, 3, 1))

for(var in vars_graficar) {
  datos_var <- datos[[var]][!is.na(datos[[var]])]
  
  hist(datos_var, 
       probability = TRUE,
       main = paste("Histograma:", var),
       xlab = var,
       col = "#3498db",
       border = "white",
       las = 1)
  
  curve(dnorm(x, mean = mean(datos_var), sd = sd(datos_var)), 
        add = TRUE, col = "#e74c3c", lwd = 2)
  
  lines(density(datos_var), col = "#2ecc71", lwd = 2)
  
  legend("topright", 
         legend = c("Normal teórica", "Densidad real"),
         col = c("#e74c3c", "#2ecc71"), 
         lwd = 2, cex = 0.7, bty = "n")
}

par(mfrow = c(1, 1))
```

## Tipo de Distribución

```{r tipo-distribucion}
identificar_distribucion <- function(asimetria, curtosis) {
  if(abs(asimetria) < 0.5 && abs(curtosis - 3) < 0.5) {
    return("Aproximadamente Normal")
  } else if(asimetria > 1) {
    return("Sesgada a la derecha")
  } else if(asimetria < -1) {
    return("Sesgada a la izquierda")
  } else if(curtosis > 4) {
    return("Leptocúrtica")
  } else if(curtosis < 2) {
    return("Platicúrtica")
  } else {
    return("Asimétrica")
  }
}

resumen_numericas$Tipo_Distribucion <- mapply(
  identificar_distribucion,
  resumen_numericas$Asimetria,
  resumen_numericas$Curtosis
)

resumen_numericas %>%
  select(Variable, Asimetria, Curtosis, Tipo_Distribucion) %>%
  mutate(
    Asimetria = round(Asimetria, 2),
    Curtosis = round(Curtosis, 2)
  ) %>%
  kable(
    caption = "Tabla 6: Clasificación de Distribuciones",
    col.names = c("Variable", "Asimetría", "Curtosis", "Tipo de Distribución"),
    align = c('l', 'r', 'r', 'l')
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#f39c12") %>%
  scroll_box(width = "100%", height = "400px")
```

------------------------------------------------------------------------

# Exploración de Variables Categóricas

## Variables Categóricas Identificadas

```{r identificar-categoricas}
vars_categoricas <- c()

for(var in names(datos)) {
  if(is.character(datos[[var]])) {
    vars_categoricas <- c(vars_categoricas, var)
  } else if(is.numeric(datos[[var]])) {
    n_unicos <- length(unique(na.omit(datos[[var]])))
    if(n_unicos < 20) {
      vars_categoricas <- c(vars_categoricas, var)
    }
  }
}
```

::: {.alert .alert-success}
**Total de variables categóricas identificadas:** `r length(vars_categoricas)`

Variables: `r paste(vars_categoricas[1:min(10, length(vars_categoricas))], collapse = ", ")`, ...
:::

## Tablas de Frecuencia {.tabset}

```{r funcion-frecuencias}
crear_tabla_frecuencias <- function(variable, nombre_var) {
  tabla <- as.data.frame(table(variable, useNA = "ifany"))
  colnames(tabla) <- c(nombre_var, "Frecuencia")
  
  tabla$Freq_Relativa <- tabla$Frecuencia / sum(tabla$Frecuencia)
  tabla$Porcentaje <- round(tabla$Freq_Relativa * 100, 2)
  tabla$Freq_Acumulada <- cumsum(tabla$Frecuencia)
  tabla$Porc_Acumulado <- round(cumsum(tabla$Freq_Relativa) * 100, 2)
  
  return(tabla)
}
```

### SEXO

```{r tabla-sexo}
if("SEXO" %in% names(datos)) {
  tabla <- crear_tabla_frecuencias(datos$SEXO, "SEXO")
  
  tabla %>%
    kable(
      caption = "Tabla 7: Distribución de Frecuencias - SEXO",
      align = c('c', 'r', 'r', 'r', 'r', 'r')
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE,
      position = "center"
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#3498db")
  
  # Gráfico
  ggplot(datos, aes(x = factor(SEXO), fill = factor(SEXO))) +
    geom_bar(color = "black") +
    geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 5) +
    scale_fill_manual(values = c("#3498db", "#e74c3c", "#95a5a6")) +
    labs(
      title = "Distribución por Sexo",
      x = "Sexo (1=Masculino, 2=Femenino, 9=No especificado)",
      y = "Frecuencia"
    ) +
    theme_minimal() +
    theme(
      legend.position = "none",
      plot.title = element_text(hjust = 0.5, face = "bold", size = 14)
    )
}
```

### ASISREC

```{r tabla-asisrec}
if("ASISREC" %in% names(datos)) {
  tabla <- crear_tabla_frecuencias(datos$ASISREC, "ASISREC")
  
  tabla %>%
    kable(
      caption = "Tabla 8: Distribución de Frecuencias - ASISREC (Asistencia Recibida)",
      align = c('c', 'r', 'r', 'r', 'r', 'r')
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE,
      position = "center"
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#2ecc71")
}
```

### SITIOOCU

```{r tabla-sitioocu}
if("SITIOOCU" %in% names(datos)) {
  tabla <- crear_tabla_frecuencias(datos$SITIOOCU, "SITIOOCU")
  
  tabla %>%
    kable(
      caption = "Tabla 9: Distribución de Frecuencias - SITIOOCU (Sitio de Ocurrencia)",
      align = c('c', 'r', 'r', 'r', 'r', 'r')
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE,
      position = "center"
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#9b59b6")
}
```

### CAUDEF

```{r tabla-caudef}
if("CAUDEF" %in% names(datos)) {
  tabla <- crear_tabla_frecuencias(datos$CAUDEF, "CAUDEF")
  
  # Mostrar top 20
  tabla_top20 <- head(tabla[order(-tabla$Frecuencia), ], 20)
  
  tabla_top20 %>%
    kable(
      caption = "Tabla 10: Top 20 Causas de Defunción más Frecuentes",
      align = c('l', 'r', 'r', 'r', 'r', 'r')
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE,
      position = "center"
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#e74c3c") %>%
    scroll_box(width = "100%", height = "500px")
  
  # Gráfico Top 15
  top15 <- head(tabla[order(-tabla$Frecuencia), ], 15)
  
  ggplot(top15, aes(x = reorder(CAUDEF, Frecuencia), y = Frecuencia)) +
    geom_bar(stat = "identity", fill = "#e74c3c", color = "black") +
    coord_flip() +
    geom_text(aes(label = Frecuencia), hjust = -0.2, size = 3.5) +
    labs(
      title = "Top 15 Causas de Defunción",
      x = "Código de Causa",
      y = "Frecuencia"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
      axis.text.y = element_text(size = 10)
    )
}
```

------------------------------------------------------------------------

# Gráficos Exploratorios

A continuación se presentan gráficos exploratorios que permiten visualizar el estado general de los datos, identificar patrones, valores atípicos y distribuciones antes de profundizar en relaciones entre variables.

## Distribución de Variables Numéricas Clave {.tabset}

### Boxplots Comparativos

```{r boxplots-exploratorios, fig.width=12, fig.height=8}
vars_boxplot <- c("EDADM", "SEMGES", "TOHITE", "TOHINM", "TOHIVI")
vars_boxplot <- vars_boxplot[vars_boxplot %in% names(datos)]

if(length(vars_boxplot) > 0) {
  datos_long <- datos %>%
    select(all_of(vars_boxplot)) %>%
    pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
    filter(!is.na(Valor), Valor < 900)
  
  ggplot(datos_long, aes(x = Variable, y = Valor, fill = Variable)) +
    geom_boxplot(outlier.color = "#e74c3c", outlier.alpha = 0.3, outlier.size = 0.8) +
    stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "black") +
    scale_fill_brewer(palette = "Set2") +
    labs(
      title = "Boxplots de Variables Numéricas Clave",
      subtitle = "Se excluyen códigos especiales (≥900). El diamante negro indica la media.",
      x = NULL, y = "Valor"
    ) +
    theme_minimal(base_size = 13) +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(hjust = 0.5, size = 10, color = "gray40"),
      legend.position = "none"
    )
}
```

### Densidades Superpuestas

```{r densidades-exploratorias, fig.width=12, fig.height=6}
vars_densidad <- c("EDADM", "SEMGES")
vars_densidad <- vars_densidad[vars_densidad %in% names(datos)]

if(length(vars_densidad) > 0) {
  plots_densidad <- list()
  
  for(v in vars_densidad) {
    datos_filtrados <- datos %>%
      filter(!is.na(.data[[v]]), .data[[v]] < 900)
    
    p <- ggplot(datos_filtrados, aes(x = .data[[v]])) +
      geom_histogram(aes(y = after_stat(density)), bins = 40, 
                     fill = "#3498db", color = "white", alpha = 0.6) +
      geom_density(color = "#e74c3c", linewidth = 1.2) +
      geom_vline(aes(xintercept = mean(.data[[v]], na.rm = TRUE)), 
                 color = "#2c3e50", linetype = "dashed", linewidth = 0.8) +
      geom_vline(aes(xintercept = median(.data[[v]], na.rm = TRUE)), 
                 color = "#27ae60", linetype = "dotted", linewidth = 0.8) +
      labs(
        title = paste("Distribución de", v),
        subtitle = "Línea punteada = mediana | Línea discontinua = media",
        x = v, y = "Densidad"
      ) +
      theme_minimal(base_size = 12) +
      theme(plot.title = element_text(hjust = 0.5, face = "bold"),
            plot.subtitle = element_text(hjust = 0.5, size = 9, color = "gray40"))
    
    plots_densidad[[v]] <- p
  }
  
  do.call(grid.arrange, c(plots_densidad, ncol = length(plots_densidad)))
}
```

## Composición de Variables Categóricas {.tabset}

### Distribución por Sexo

```{r grafico-sexo, fig.width=8, fig.height=5}
if("SEXO" %in% names(datos)) {
  datos_sexo <- datos %>%
    filter(!is.na(SEXO)) %>%
    mutate(SEXO_label = case_when(
      SEXO == 1 ~ "Masculino",
      SEXO == 2 ~ "Femenino",
      SEXO == 9 ~ "No especificado",
      TRUE ~ as.character(SEXO)
    )) %>%
    count(SEXO_label) %>%
    mutate(porcentaje = round(n / sum(n) * 100, 1))
  
  ggplot(datos_sexo, aes(x = reorder(SEXO_label, -n), y = n, fill = SEXO_label)) +
    geom_col(width = 0.6, show.legend = FALSE) +
    geom_text(aes(label = paste0(format(n, big.mark = ","), "\n(", porcentaje, "%)")),
              vjust = -0.3, size = 4, fontface = "bold") +
    scale_fill_manual(values = c("Masculino" = "#3498db", "Femenino" = "#e91e63", 
                                 "No especificado" = "#95a5a6")) +
    labs(title = "Distribución por Sexo", x = NULL, y = "Frecuencia") +
    theme_minimal(base_size = 13) +
    theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.15)))
}
```

### Área Geográfica

```{r grafico-area, fig.width=8, fig.height=5}
if("AREAG" %in% names(datos)) {
  datos_area <- datos %>%
    filter(!is.na(AREAG)) %>%
    mutate(AREAG_label = case_when(
      AREAG == 1 ~ "Urbana",
      AREAG == 2 ~ "Rural",
      TRUE ~ as.character(AREAG)
    )) %>%
    count(AREAG_label) %>%
    mutate(porcentaje = round(n / sum(n) * 100, 1))
  
  ggplot(datos_area, aes(x = "", y = n, fill = AREAG_label)) +
    geom_col(width = 1) +
    coord_polar(theta = "y") +
    geom_text(aes(label = paste0(AREAG_label, "\n", porcentaje, "%")),
              position = position_stack(vjust = 0.5), size = 5, fontface = "bold") +
    scale_fill_manual(values = c("Urbana" = "#2ecc71", "Rural" = "#f39c12")) +
    labs(title = "Distribución por Área Geográfica", fill = "Área") +
    theme_void(base_size = 13) +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
}
```

### Asistencia Recibida

```{r grafico-asistencia, fig.width=8, fig.height=5}
if("ASISREC" %in% names(datos)) {
  datos_asis <- datos %>%
    filter(!is.na(ASISREC)) %>%
    mutate(ASISREC_label = case_when(
      ASISREC == 1 ~ "Sí recibió",
      ASISREC == 2 ~ "No recibió",
      TRUE ~ as.character(ASISREC)
    )) %>%
    count(ASISREC_label) %>%
    mutate(porcentaje = round(n / sum(n) * 100, 1))
  
  ggplot(datos_asis, aes(x = reorder(ASISREC_label, -n), y = n, fill = ASISREC_label)) +
    geom_col(width = 0.5, show.legend = FALSE) +
    geom_text(aes(label = paste0(format(n, big.mark = ","), "\n(", porcentaje, "%)")),
              vjust = -0.3, size = 4, fontface = "bold") +
    scale_fill_manual(values = c("Sí recibió" = "#27ae60", "No recibió" = "#c0392b")) +
    labs(title = "Asistencia Recibida durante el Parto", x = NULL, y = "Frecuencia") +
    theme_minimal(base_size = 13) +
    theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.15)))
}
```

## Panorama Temporal {.tabset}

### Registros por Año

```{r registros-anio, fig.width=12, fig.height=6}
if("AÑOREG" %in% names(datos)) {
  registros_anio <- datos %>%
    filter(!is.na(AÑOREG)) %>%
    count(AÑOREG)
  
  ggplot(registros_anio, aes(x = AÑOREG, y = n)) +
    geom_line(color = "#2c3e50", linewidth = 1) +
    geom_point(color = "#e74c3c", size = 3) +
    geom_area(alpha = 0.15, fill = "#3498db") +
    geom_text(aes(label = format(n, big.mark = ",")), vjust = -1, size = 3.2) +
    labs(
      title = "Evolución del Número de Registros por Año",
      x = "Año de Registro", y = "Cantidad de Registros"
    ) +
    scale_x_continuous(breaks = seq(min(registros_anio$AÑOREG), max(registros_anio$AÑOREG), 1)) +
    theme_minimal(base_size = 13) +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold"),
      axis.text.x = element_text(angle = 45, hjust = 1)
    ) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.12)))
}
```

### Distribución Mensual

```{r registros-mes, fig.width=10, fig.height=6}
if("MESOCU" %in% names(datos)) {
  meses_nombres <- c("Ene", "Feb", "Mar", "Abr", "May", "Jun",
                     "Jul", "Ago", "Sep", "Oct", "Nov", "Dic")
  
  registros_mes <- datos %>%
    filter(!is.na(MESOCU), MESOCU >= 1, MESOCU <= 12) %>%
    count(MESOCU) %>%
    mutate(Mes = factor(meses_nombres[MESOCU], levels = meses_nombres))
  
  ggplot(registros_mes, aes(x = Mes, y = n, fill = n)) +
    geom_col(show.legend = FALSE) +
    scale_fill_gradient(low = "#85c1e9", high = "#1a5276") +
    geom_text(aes(label = format(n, big.mark = ",")), vjust = -0.3, size = 3.5) +
    labs(
      title = "Distribución de Ocurrencias por Mes",
      x = "Mes de Ocurrencia", y = "Frecuencia"
    ) +
    theme_minimal(base_size = 13) +
    theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.1)))
}
```

## Detección de Valores Atípicos y Datos Faltantes

```{r valores-atipicos, fig.width=12, fig.height=7}
vars_revision <- c("EDADM", "SEMGES", "TOHITE", "TOHINM", "TOHIVI", "ESCOLAM")
vars_revision <- vars_revision[vars_revision %in% names(datos)]

if(length(vars_revision) > 0) {
  resumen_atipicos <- data.frame(
    Variable = character(),
    N_total = integer(),
    N_NA = integer(),
    Porc_NA = numeric(),
    N_codigo_999 = integer(),
    Porc_999 = numeric(),
    stringsAsFactors = FALSE
  )
  
  for(v in vars_revision) {
    vals <- datos[[v]]
    n_total <- length(vals)
    n_na <- sum(is.na(vals))
    n_999 <- sum(vals >= 99 & !is.na(vals))
    
    resumen_atipicos <- rbind(resumen_atipicos, data.frame(
      Variable = v,
      N_total = n_total,
      N_NA = n_na,
      Porc_NA = round(n_na / n_total * 100, 2),
      N_codigo_999 = n_999,
      Porc_999 = round(n_999 / n_total * 100, 2)
    ))
  }
  
  resumen_atipicos %>%
    kable(
      caption = "Detección de Valores Atípicos y Códigos Especiales",
      col.names = c("Variable", "N Total", "N Faltantes (NA)", "% NA", 
                     "N Códigos ≥99", "% Códigos ≥99"),
      align = c('l', rep('r', 5))
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover", "condensed"),
      full_width = FALSE
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#8e44ad")
}
```

```{r heatmap-faltantes, fig.width=12, fig.height=6}
vars_heatmap <- names(datos)[sapply(datos, is.numeric)]

porc_faltantes <- sapply(datos[vars_heatmap], function(x) {
  na_real <- sum(is.na(x))
  cod_especial <- sum(x %in% c(99, 999, 9999) & !is.na(x))
  round((na_real + cod_especial) / length(x) * 100, 1)
})

df_faltantes <- data.frame(
  Variable = names(porc_faltantes),
  Porcentaje = as.numeric(porc_faltantes)
) %>%
  arrange(desc(Porcentaje))

ggplot(df_faltantes, aes(x = reorder(Variable, Porcentaje), y = Porcentaje, fill = Porcentaje)) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient(low = "#27ae60", high = "#e74c3c", name = "% Datos\nProblema") +
  geom_text(aes(label = paste0(Porcentaje, "%")), hjust = -0.1, size = 3.5) +
  labs(
    title = "Porcentaje de Datos Faltantes o con Códigos Especiales por Variable",
    subtitle = "Incluye NA y códigos como 99, 999, 9999",
    x = NULL, y = "Porcentaje (%)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 10, color = "gray40")
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.12)))
```

::: {.alert .alert-warning}
**Observaciones de los Gráficos Exploratorios:**

-   Los **boxplots** revelan la presencia de valores extremos que probablemente corresponden a códigos de datos faltantes (99, 999, 9999)
-   Las **distribuciones de densidad** muestran el sesgo y la forma real de las variables clave
-   La **tendencia temporal** permite identificar cambios en el volumen de registros a lo largo de los años
-   La **distribución mensual** muestra si existe estacionalidad en las ocurrencias
-   El gráfico de **datos faltantes** ayuda a priorizar qué variables necesitan limpieza antes de análisis posteriores
:::

------------------------------------------------------------------------

# Relaciones entre Variables

## Análisis de Correlación

### Matriz de Correlación

```{r matriz-correlacion, fig.width=10, fig.height=8}
# Seleccionar variables numéricas continuas clave para correlación
vars_correlacion <- c("AÑOREG", "MESREG", "EDADM", "SEMGES", 
                      "TOHITE", "TOHINM", "TOHIVI", "ESCOLAM")

# Filtrar solo las que existen en el dataset
vars_correlacion <- vars_correlacion[vars_correlacion %in% names(datos)]

# Crear subset sin NAs
datos_corr <- datos[, vars_correlacion]
datos_corr <- na.omit(datos_corr)

# Calcular matriz de correlación
matriz_correlacion <- cor(datos_corr)

# Mostrar matriz en tabla
matriz_correlacion %>%
  round(3) %>%
  kable(
    caption = "Tabla 11: Matriz de Correlación de Pearson",
    align = 'c'
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE,
    font_size = 11
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#e74c3c")

# Visualizar matriz de correlación
corrplot(matriz_correlacion, 
         method = "color",
         type = "upper",
         addCoef.col = "black",
         number.cex = 0.7,
         tl.col = "black",
         tl.srt = 45,
         title = "Matriz de Correlación",
         mar = c(0, 0, 2, 0))
```

### Correlaciones Significativas

```{r correlaciones-significativas}
# Identificar correlaciones significativas (|r| > 0.3)
correlaciones_significativas <- data.frame()

for(i in 1:(ncol(matriz_correlacion)-1)) {
  for(j in (i+1):ncol(matriz_correlacion)) {
    cor_valor <- matriz_correlacion[i, j]
    if(abs(cor_valor) > 0.3) {
      correlaciones_significativas <- rbind(
        correlaciones_significativas,
        data.frame(
          Variable_1 = rownames(matriz_correlacion)[i],
          Variable_2 = colnames(matriz_correlacion)[j],
          Correlacion = cor_valor,
          Fuerza = ifelse(abs(cor_valor) > 0.7, "Fuerte",
                   ifelse(abs(cor_valor) > 0.5, "Moderada", "Débil")),
          Direccion = ifelse(cor_valor > 0, "Positiva", "Negativa")
        )
      )
    }
  }
}

# Ordenar por valor absoluto de correlación
if(nrow(correlaciones_significativas) > 0) {
  correlaciones_significativas <- correlaciones_significativas[
    order(-abs(correlaciones_significativas$Correlacion)), 
  ]
  
  correlaciones_significativas %>%
    mutate(Correlacion = round(Correlacion, 3)) %>%
    kable(
      caption = "Tabla 12: Correlaciones Significativas (|r| > 0.3)",
      col.names = c("Variable 1", "Variable 2", "r", "Fuerza", "Dirección"),
      align = c('l', 'l', 'r', 'c', 'c')
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#2ecc71")
} else {
  cat("No se encontraron correlaciones significativas (|r| > 0.3)\n")
}
```

## Gráficos de Dispersión {.tabset}

### Edad vs Semanas de Gestación

```{r scatter-edad-semges}
if("EDADM" %in% names(datos) && "SEMGES" %in% names(datos)) {
  ggplot(datos %>% filter(EDADM < 100, SEMGES < 100), 
         aes(x = EDADM, y = SEMGES)) +
    geom_point(alpha = 0.3, color = "#3498db") +
    geom_smooth(method = "lm", color = "#e74c3c", se = TRUE) +
    labs(
      title = "Relación: Edad de la Madre vs Semanas de Gestación",
      x = "Edad de la Madre (años)",
      y = "Semanas de Gestación"
    ) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
}
```

### Edad vs Total de Hijos

```{r scatter-edad-hijos}
if("EDADM" %in% names(datos) && "TOHITE" %in% names(datos)) {
  ggplot(datos %>% filter(EDADM < 100, TOHITE < 50), 
         aes(x = EDADM, y = TOHITE)) +
    geom_point(alpha = 0.3, color = "#2ecc71") +
    geom_smooth(method = "lm", color = "#e74c3c", se = TRUE) +
    labs(
      title = "Relación: Edad de la Madre vs Total de Hijos Tenidos",
      x = "Edad de la Madre (años)",
      y = "Total de Hijos Tenidos"
    ) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
}
```

### Semanas vs Hijos Vivos

```{r scatter-semges-vivos}
if("SEMGES" %in% names(datos) && "TOHIVI" %in% names(datos)) {
  ggplot(datos %>% filter(SEMGES < 100, TOHIVI < 50), 
         aes(x = SEMGES, y = TOHIVI)) +
    geom_point(alpha = 0.3, color = "#9b59b6") +
    geom_smooth(method = "lm", color = "#e74c3c", se = TRUE) +
    labs(
      title = "Relación: Semanas de Gestación vs Total de Hijos Vivos",
      x = "Semanas de Gestación",
      y = "Total de Hijos Vivos"
    ) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
}
```

## Tablas de Contingencia

### SEXO vs ASISREC

```{r contingencia-sexo-asis}
if("SEXO" %in% names(datos) && "ASISREC" %in% names(datos)) {
  # Crear tabla
  tabla_sexo_asis <- table(datos$SEXO, datos$ASISREC)
  
  # Mostrar tabla con totales
  addmargins(tabla_sexo_asis) %>%
    kable(
      caption = "Tabla 13: Tabla de Contingencia - SEXO vs ASISREC"
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#3498db")
  
  # Proporciones por fila (%) - CORRECCIÓN AQUÍ
  cat("\n\nProporciones por fila (%):\n")
  
  (prop.table(tabla_sexo_asis, 1) * 100) %>%
    round(2) %>%
    kable(caption = "Porcentajes por fila") %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
    print()
  
  # Test de independencia Chi-cuadrado
  test_chi <- chisq.test(tabla_sexo_asis)
  
  cat("\n\n**Test de Independencia Chi-cuadrado:**\n")
  cat("- Estadístico χ²:", round(test_chi$statistic, 4), "\n")
  cat("- p-valor:", format.pval(test_chi$p.value, digits = 4), "\n")
  
  if(test_chi$p.value < 0.05) {
    cat("\n**Conclusión:** Las variables NO son independientes (p < 0.05)\n")
    cat("Existe una relación estadísticamente significativa entre SEXO y ASISREC\n")
  } else {
    cat("\n**Conclusión:** Las variables son independientes (p >= 0.05)\n")
    cat("No hay evidencia de relación entre SEXO y ASISREC\n")
  }
}
```

### SEXO vs SITIOOCU

```{r contingencia-sexo-sitio}
if("SEXO" %in% names(datos) && "SITIOOCU" %in% names(datos)) {
  tabla_sexo_sitio <- table(datos$SEXO, datos$SITIOOCU)
  
  addmargins(tabla_sexo_sitio) %>%
    kable(
      caption = "Tabla 14: Tabla de Contingencia - SEXO vs SITIOOCU"
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#2ecc71")
  
  # Test Chi-cuadrado
  test_chi2 <- chisq.test(tabla_sexo_sitio)
  cat("\n**Chi-cuadrado p-valor:**", format.pval(test_chi2$p.value, digits = 4), "\n")
}
```

### AREAG vs ASISREC

```{r contingencia-area-asis}
if("AREAG" %in% names(datos) && "ASISREC" %in% names(datos)) {
  tabla_area_asis <- table(datos$AREAG, datos$ASISREC)
  
  addmargins(tabla_area_asis) %>%
    kable(
      caption = "Tabla 15: Tabla de Contingencia - AREAG vs ASISREC"
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = FALSE
    ) %>%
    row_spec(0, bold = TRUE, color = "white", background = "#9b59b6")
  
  # Test Chi-cuadrado
  test_chi3 <- chisq.test(tabla_area_asis)
  cat("\n**Chi-cuadrado p-valor:**", format.pval(test_chi3$p.value, digits = 4), "\n")
  
  if(test_chi3$p.value < 0.05) {
    cat("\n**Conclusión:** El área geográfica SÍ influye en la asistencia recibida (p < 0.05)\n")
  } else {
    cat("\n**Conclusión:** El área geográfica NO influye significativamente en la asistencia (p >= 0.05)\n")
  }
}
```

## Visualizaciones de Relaciones {.tabset}

### Barras Agrupadas

```{r barras-agrupadas}
if("SEXO" %in% names(datos) && "ASISREC" %in% names(datos)) {
  datos_graf <- datos %>%
    filter(!is.na(SEXO) & !is.na(ASISREC) & SEXO %in% c(1, 2)) %>%
    mutate(
      Sexo = factor(SEXO, levels = c(1, 2), 
                    labels = c("Masculino", "Femenino")),
      Asistencia = factor(ASISREC, levels = c(1, 2),
                         labels = c("Sí recibió", "No recibió"))
    ) %>%
    group_by(Sexo, Asistencia) %>%
    summarise(Frecuencia = n(), .groups = "drop")
  
  ggplot(datos_graf, aes(x = Sexo, y = Frecuencia, fill = Asistencia)) +
    geom_bar(stat = "identity", position = "dodge", color = "black") +
    geom_text(aes(label = Frecuencia), 
              position = position_dodge(width = 0.9),
              vjust = -0.5, size = 3.5) +
    scale_fill_manual(values = c("#2ecc71", "#e74c3c")) +
    labs(
      title = "Asistencia Recibida por Sexo",
      x = "Sexo",
      y = "Frecuencia",
      fill = "Asistencia"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
      legend.position = "top"
    )
}
```

### Boxplots por Grupo

```{r boxplots}
# Boxplot: Edad de la Madre por Sexo del bebé
if("EDADM" %in% names(datos) && "SEXO" %in% names(datos)) {
  datos_box <- datos %>%
    filter(EDADM < 100 & SEXO %in% c(1, 2)) %>%
    mutate(Sexo = factor(SEXO, levels = c(1, 2), 
                        labels = c("Masculino", "Femenino")))
  
  ggplot(datos_box, aes(x = Sexo, y = EDADM, fill = Sexo)) +
    geom_boxplot(alpha = 0.7) +
    scale_fill_manual(values = c("#3498db", "#e74c3c")) +
    labs(
      title = "Distribución de Edad de la Madre por Sexo del Bebé",
      x = "Sexo del Bebé",
      y = "Edad de la Madre (años)"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold"),
      legend.position = "none"
    )
}
```

### Tendencia Temporal

```{r tendencia-temporal}
if("AÑOREG" %in% names(datos)) {
  tendencia_anual <- datos %>%
    group_by(AÑOREG) %>%
    summarise(
      Total_Registros = n(),
      Edad_Promedio = mean(EDADM, na.rm = TRUE),
      Semanas_Promedio = mean(SEMGES, na.rm = TRUE)
    ) %>%
    filter(AÑOREG >= 2009 & AÑOREG <= 2023)
  
  # Gráfico de tendencia
  ggplot(tendencia_anual, aes(x = AÑOREG, y = Total_Registros)) +
    geom_line(color = "#3498db", size = 1.2) +
    geom_point(color = "#e74c3c", size = 3) +
    labs(
      title = "Tendencia de Registros por Año",
      x = "Año",
      y = "Número de Registros"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold"),
      axis.text.x = element_text(angle = 45, hjust = 1)
    ) +
    scale_x_continuous(breaks = seq(2009, 2023, 1))
}
```

## Resumen de Relaciones

```{r resumen-relaciones}
cat("**CORRELACIONES:**\n")
if(exists("correlaciones_significativas") && nrow(correlaciones_significativas) > 0) {
  cat("Se encontraron", nrow(correlaciones_significativas), 
      "correlaciones significativas (|r| > 0.3)\n")
  cat(" - Correlación más fuerte: r = ", 
      round(max(abs(correlaciones_significativas$Correlacion)), 3), "\n\n")
} else {
  cat("No se encontraron correlaciones fuertes entre variables numéricas\n\n")
}

cat("**ASOCIACIONES CATEGÓRICAS:**\n")
cat("- Se analizaron múltiples tablas de contingencia\n")
cat("- Se aplicaron pruebas Chi-cuadrado para independencia\n\n")

cat("**HALLAZGOS PRINCIPALES:**\n")
cat("1. Relación entre edad de la madre y total de hijos tenidos\n")
cat("2. Posible influencia del área geográfica en la asistencia recibida\n")
cat("3. Tendencia temporal observable en el número de registros\n")
cat("4. Distribución relativamente equilibrada entre sexos\n")
```

# Preguntas de Investigación Basadas en Supuestos

A continuación se plantean cinco hipótesis preliminares basadas en creencias intuitivas sobre el fenómeno estudiado. Cada una será validada o refutada mediante análisis estadístico y visualización.

## Pregunta 1

### Hipótesis

Las madres que viven en área rural reciben menos asistencia durante el parto que las que viven en área urbana.

### Analisis

```{r}
# Tabla de contingencia
tabla_area_asis <- table(datos$AREAG, datos$ASISREC)

# Proporciones por fila
prop_area_asis <- prop.table(tabla_area_asis, 1) * 100

kable(round(prop_area_asis,2),
      caption = "Porcentaje de Asistencia por Área Geográfica")

# Prueba Chi-cuadrado
chisq_area_asis <- chisq.test(tabla_area_asis)
chisq_area_asis

```

### Interpretación

El test de chi cuadrado arroja un valor p \< 2.2e-16, lo que permite rechazar la hipótesis nula de independencia con un nivel de confianza del 95%. La tabla de proporciones muestra que en el área rural el porcentaje de partos atendidos por comadronas es significativamente mayor que en el área urbana, donde predomina la asistencia médica.

### Discusión

Se acepta la hipótesis planteada. Existe una brecha estructural en el acceso a la salud pública en Guatemala. El área rural depende fuertemente de la medicina tradicional, posiblemente debido a la lejanía de los centros hospitalarios o demás factores socioculturales, mientras que en el área urbana se concentran los recursos profesionales.

## Pregunta 2

### Hipótesis

Las madres de mayor edad tienden a tener más hijos.

### Analisis

```{r}
cor.test(datos$EDADM, datos$TOHITE, use = "complete.obs")

ggplot(datos %>% filter(EDADM < 60, TOHITE < 20),
       aes(x = EDADM, y = TOHITE)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", color = "red") +
  theme_minimal() +
  labs(title = "Edad vs Total de Hijos")

```

### Interpretación

Se observa una correlación positiva moderada r ≈ 0.46 con un valor p significativo. El gráfico de dispersión muestra una tendencia ascendente clara; a medida que aumenta la edad de la madre (EDADM), también lo hace el total de hijos (TOHITE). La línea de regresión roja confirma esta relación lineal entre ambas variables.

### Discusión

Se acepta la hipótesis. Si bien es biológicamente lógico que a mayor edad exista una mayor probabilidad de tener más hijos, la dispersión de los datos también revela casos de madres jóvenes con un número elevado de hijos, lo cual sugiere que la edad no es el único factor determinante, aunque sí el más evidente de forma estadística.

## Pregunta 3

### Hipótesis

Existe estacionalidad en las ocurrencias (algunos meses concentran más casos).

### Analisis

```{r}
registros_mes <- datos %>%
  filter(MESOCU >=1 & MESOCU <=12) %>%
  count(MESOCU)

ggplot(registros_mes, aes(x = MESOCU, y = n)) +
  geom_col(fill = "steelblue") +
  theme_minimal() +
  labs(title = "Distribución mensual de ocurrencias")

```

### Interpretación

El gráfico de barras muestra la distribución de frecuencias por mes. Si bien existe una distribución a lo largo de todo el año, se observa un ligero incremento en el meses de Enero. No se detectan meses con valores cercanos a cero, lo que indica un flujo constante de registros.

### Discusión

La hipótesis se acepta parcialmente. Aunque no hay una variación extrema que indique que los nacimientos se detienen en ciertas épocas, el pico detectado sugiere una planificación o estacionalidad biológica que podría saturar los servicios de salud en el mes de Enero. Esto es clave para la asignación de recursos hospitalarios durante inicios de año.

## Pregunta 4

### Hipótesis

Las madres con menor nivel educativo tienen más hijos.

### Analisis

```{r}
cor.test(datos$ESCOLAM, datos$TOHITE, use = "complete.obs")

ggplot(datos %>% filter(ESCOLAM < 20, TOHITE < 20),
       aes(x = ESCOLAM, y = TOHITE)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", color = "red") +
  theme_minimal() +
  labs(title = "Escolaridad vs Total de Hijos")

```

### Interpretación

El análisis de correlación muestra un coeficiente negativo r ≈ -0.32 con significancia estadística. Esto indica una relación inversamente proporcional; a medida que el nivel educativo (ESCOLAM) aumenta, el total de hijos (TOHITE) tiende a disminuir. El gráfico de dispersión muestra una mayor densidad de familias numerosas en los niveles bajos de escolaridad.

### Discusión

Se confirma la hipótesis. La educación actúa como un factor determinante en la planificación familiar. Las madres con acceso a educación superior tienden a postergar la maternidad o a tener menos hijos, lo que valida la teoría de que el desarrollo académico impacta directamente en las decisiones reproductivas y el nivel socioeconómico.

## Pregunta 5

### Hipótesis

El sitio de ocurrencia influye en la asistencia recibida.

### Analisis

```{r}
tabla_sitio_asis <- table(datos$SITIOOCU, datos$ASISREC)
chisq.test(tabla_sitio_asis)
```

### Interpretación

El test de chi cuadrado arroja un valor p \< 2.2e-16, indicando una dependencia total entre las variables. Los datos sugieren que los partos ocurridos en instituciones de salud públicas o privadas reciben asistencia médica profesional, mientras que los partos domiciliarios son atendidos mayoritariamente por personal no médico.

### Discusión

Se acepta la hipótesis. El lugar del parto dicta el tipo de atención. Este hallazgo es crítico, ya que sugiere que el riesgo de complicaciones aumenta en los partos domiciliarios no solo por el entorno, sino por la falta de asistencia técnica calificada. Esto refuerza la necesidad de fortalecer los servicios de salud locales para incentivar el parto institucional.

# Clustering

El objetivo del clustering es identificar grupos homogéneos de registros según características similares.

## Selección de Variables

Usaremos variables numéricas relevantes:

EDADM (edad madre)

SEMGES (semanas gestación)

TOHITE (total hijos)

ESCOLAM (escolaridad)

## Preparacion de variables y generación de clusters

```{r}
library(cluster)
library(factoextra)

datos_cluster <- datos %>%
  select(EDADM, SEMGES, TOHITE, ESCOLAM) %>%
  filter(
    EDADM < 60,
    SEMGES < 50,
    TOHITE < 20,
    ESCOLAM < 20
  ) %>%
  na.omit()

datos_scaled <- scale(datos_cluster)

wss <- numeric(10)
for(i in 1:10){
  wss[i] <- sum(kmeans(datos_scaled, centers=i, nstart=10)$withinss)
}
plot(1:10, wss, type="b",
     xlab="Número de clusters",
     ylab="Suma de cuadrados intra-grupo")

set.seed(123)
k3 <- kmeans(datos_scaled, centers=3, nstart=25)
datos_cluster$cluster <- factor(k3$cluster)

sil <- silhouette(k3$cluster, dist(datos_scaled))

fviz_silhouette(sil) +
  labs(title = "Gráfico de Silueta para k = 3") +
  theme_minimal()

avg_sil <- mean(sil[, 3])
print(paste("El ancho promedio de la silueta es:", round(avg_sil, 2)))

ggplot(datos_cluster, aes(x=EDADM, y=TOHITE, color=cluster)) +
  geom_point(alpha=0.6) +
  theme_minimal() +
  labs(title="Clusters según Edad y Número de Hijos")

aggregate(datos_cluster[,1:4],
          by=list(Cluster=datos_cluster$cluster),
          mean)
```

## Interpretación de clusters

El método del codo indicó que el número óptimo de grupos es k = 3, ya que a partir de este punto la reducción en la suma de cuadrados intra-grupo se estabiliza, indicando rendimientos decrecientes al aumentar el número de clusters.

El análisis de medias permitió identificar tres perfiles diferenciados:

Cluster 1 (Perfil intermedio educado): Madres con edad promedio de 29 años, nivel educativo medio (≈9 años) y número moderado de hijos (≈3.8). Representa un grupo con características intermedias tanto en edad como en fecundidad.

Cluster 2 (Perfil joven con baja escolaridad): Grupo más joven (≈26 años), con bajo nivel educativo (≈2 años) y menor número de hijos (≈2.7). Puede representar madres en etapa inicial reproductiva y en situación de vulnerabilidad educativa.

Cluster 3 (Perfil de mayor edad y alta fecundidad): Madres de mayor edad (≈36 años), con el mayor número promedio de hijos (≈6.3) y el nivel educativo más bajo (≈1.5 años). Este grupo refleja un patrón de alta fecundidad asociado a baja escolaridad.

Los resultados sugieren una relación estructural entre edad, escolaridad y número de hijos, donde niveles educativos más bajos se asocian con mayor fecundidad. El clustering permitió identificar perfiles poblacionales claramente diferenciados, lo cual puede ser relevante para el diseño de políticas públicas focalizadas.

------------------------------------------------------------------------

# Documentación de Operaciones de Limpieza de Datos

A lo largo del análisis exploratorio se aplicaron diversas operaciones de limpieza y filtrado para garantizar la calidad y coherencia de los resultados. A continuación se documenta cada una de ellas de forma estructurada.

## Resumen de Operaciones de Limpieza

```{r tabla-limpieza}
operaciones_limpieza <- data.frame(
  No = 1:10,
  Operacion = c(
    "Eliminación de valores NA (na.omit / !is.na)",
    "Exclusión de códigos especiales ≥ 900",
    "Filtro de edad de la madre (EDADM < 100)",
    "Filtro de semanas de gestación (SEMGES < 100)",
    "Filtro de total hijos tenidos (TOHITE < 50)",
    "Filtro de total hijos vivos (TOHIVI < 50)",
    "Validación de meses (MESOCU entre 1 y 12)",
    "Exclusión de sexo no especificado (SEXO ∈ {1, 2})",
    "Acotamiento del rango temporal (2009-2023)",
    "Identificación de códigos 99, 999, 9999 como datos faltantes"
  ),
  Justificacion = c(
    "Los registros con valores faltantes (NA) fueron excluidos en cálculos estadísticos, gráficos y tablas de frecuencia para evitar distorsiones en medias, medianas, correlaciones y pruebas de normalidad.",
    "Variables como EDADM, SEMGES, TOHITE, TOHINM y TOHIVI utilizan códigos numéricos altos (≥ 900) para representar información no disponible. Estos valores fueron excluidos en boxplots y gráficos de densidad para que las distribuciones reflejen solo datos reales.",
    "Se excluyeron registros con EDADM ≥ 100 ya que estos valores corresponden a códigos de datos faltantes (99, 999) y no a edades reales. La edad máxima biológicamente plausible para una madre es menor a 60 años.",
    "Se excluyeron registros con SEMGES ≥ 100 ya que representan códigos de datos faltantes, no semanas de gestación reales. El rango biológico válido es aproximadamente entre 20 y 42 semanas.",
    "Se excluyeron registros con TOHITE ≥ 50 para eliminar códigos especiales de datos faltantes. Es biológicamente improbable que una persona tenga 50 o más hijos.",
    "Se excluyeron registros con TOHIVI ≥ 50 bajo el mismo criterio de plausibilidad biológica y para eliminar códigos especiales.",
    "Se filtraron solo meses válidos (1 a 12), descartando valores fuera de rango que podrían representar errores de digitación o códigos especiales.",
    "En análisis de contingencia y boxplots comparativos se excluyó el código 9 (no especificado) de la variable SEXO para enfocarse en las categorías informativas (1=Masculino, 2=Femenino).",
    "Se acotó el análisis de tendencia temporal al período 2009-2023, que corresponde al rango de años con datos completos y consistentes del dataset.",
    "Los códigos numéricos 99, 999 y 9999 fueron identificados como representaciones de datos faltantes o no especificados en el sistema de registro. Se contabilizaron para medir la calidad de los datos."
  ),
  Variables_Afectadas = c(
    "Todas las variables numéricas y categóricas",
    "EDADM, SEMGES, TOHITE, TOHINM, TOHIVI",
    "EDADM",
    "SEMGES",
    "TOHITE",
    "TOHIVI",
    "MESOCU",
    "SEXO",
    "AÑOREG",
    "EDADM, SEMGES, TOHITE, TOHINM, TOHIVI, ESCOLAM"
  ),
  Seccion_Aplicada = c(
    "Estadísticas descriptivas, pruebas de normalidad, correlaciones, tablas de frecuencia, gráficos",
    "Boxplots comparativos, gráficos de densidad",
    "Gráficos de dispersión (Edad vs Semanas, Edad vs Hijos), boxplots por grupo",
    "Gráficos de dispersión (Edad vs Semanas, Semanas vs Hijos Vivos)",
    "Gráfico de dispersión (Edad vs Total Hijos)",
    "Gráfico de dispersión (Semanas vs Hijos Vivos)",
    "Gráfico de distribución mensual de ocurrencias",
    "Barras agrupadas (Sexo vs Asistencia), boxplots por grupo",
    "Gráfico de tendencia temporal",
    "Detección de valores atípicos, heatmap de datos faltantes"
  ),
  stringsAsFactors = FALSE
)

operaciones_limpieza %>%
  kable(
    caption = "Tabla: Documentación Completa de Operaciones de Limpieza de Datos",
    col.names = c("#", "Operación", "Justificación", "Variables Afectadas", "Sección Aplicada"),
    align = c('c', 'l', 'l', 'l', 'l')
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = TRUE,
    font_size = 11
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#d35400") %>%
  column_spec(2, width = "15em") %>%
  column_spec(3, width = "25em") %>%
  scroll_box(width = "100%", height = "600px")
```

## Impacto Cuantitativo de la Limpieza

```{r impacto-limpieza}
n_total <- nrow(datos)

impacto <- data.frame(
  Filtro = c(
    "Registros originales",
    "NA en EDADM",
    "NA en SEMGES",
    "EDADM ≥ 100 (códigos especiales)",
    "SEMGES ≥ 100 (códigos especiales)",
    "TOHITE ≥ 50 (códigos especiales)",
    "TOHIVI ≥ 50 (códigos especiales)",
    "SEXO = 9 (no especificado)",
    "MESOCU fuera de rango (1-12)",
    "Códigos 99/999/9999 en cualquier variable numérica"
  ),
  Registros_Afectados = c(
    n_total,
    sum(is.na(datos$EDADM)),
    sum(is.na(datos$SEMGES)),
    if("EDADM" %in% names(datos)) sum(datos$EDADM >= 100, na.rm = TRUE) else 0,
    if("SEMGES" %in% names(datos)) sum(datos$SEMGES >= 100, na.rm = TRUE) else 0,
    if("TOHITE" %in% names(datos)) sum(datos$TOHITE >= 50, na.rm = TRUE) else 0,
    if("TOHIVI" %in% names(datos)) sum(datos$TOHIVI >= 50, na.rm = TRUE) else 0,
    if("SEXO" %in% names(datos)) sum(datos$SEXO == 9, na.rm = TRUE) else 0,
    if("MESOCU" %in% names(datos)) sum(datos$MESOCU < 1 | datos$MESOCU > 12, na.rm = TRUE) else 0,
    sum(sapply(datos[sapply(datos, is.numeric)], function(x) sum(x %in% c(99, 999, 9999), na.rm = TRUE)))
  ),
  stringsAsFactors = FALSE
)

impacto$Porcentaje <- round(impacto$Registros_Afectados / n_total * 100, 2)
impacto$Porcentaje[1] <- 100.00

impacto %>%
  mutate(Registros_Afectados = format(Registros_Afectados, big.mark = ",")) %>%
  kable(
    caption = "Tabla: Impacto Cuantitativo de cada Operación de Limpieza",
    col.names = c("Filtro / Condición", "Registros Afectados", "% del Total"),
    align = c('l', 'r', 'r')
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "center"
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#d35400") %>%
  row_spec(1, bold = TRUE, background = "#f0f0f0")
```

::: {.alert .alert-warning}
**Notas Importantes sobre la Limpieza:**

-   **Los datos originales no fueron modificados.** Todas las operaciones de limpieza se aplicaron como filtros temporales dentro de cada análisis específico, preservando la integridad del dataset original.
-   **Códigos especiales:** Los valores 99, 999 y 9999 son convenciones del sistema de registro de defunciones para indicar "dato no especificado" o "dato no disponible".
-   **Criterio de exclusión:** Los umbrales utilizados (EDADM \< 100, SEMGES \< 100, TOHITE \< 50, TOHIVI \< 50) fueron seleccionados considerando los rangos biológicamente plausibles de cada variable.
-   **Reproducibilidad:** Cada filtro está implementado directamente en el bloque de código R correspondiente, lo que garantiza la reproducibilidad completa del análisis.
:::

------------------------------------------------------------------------

---

# Situación Problemática y Planteamiento del Problema

## Contexto General

Guatemala presenta uno de los índices más altos de mortalidad fetal en Centroamérica, con **41,623 defunciones fetales registradas entre 2009 y 2023** según datos del Instituto Nacional de Estadística (INE). Esta cifra representa un promedio de 2,973 casos anuales, evidenciando una problemática persistente que afecta principalmente a poblaciones vulnerables con limitado acceso a servicios de salud prenatal y obstétrica de calidad.

La mortalidad fetal no es únicamente un indicador de salud reproductiva, sino un reflejo de las condiciones socioeconómicas, la calidad del sistema de salud y las inequidades estructurales que enfrentan las mujeres guatemaltecas durante el embarazo. Cada defunción fetal representa no solo la pérdida de una vida en gestación, sino también un impacto psicológico devastador para las familias, costos económicos significativos y la evidencia de fallas en la prevención y atención médica oportuna.

## Análisis de la Situación Actual

El análisis exploratorio de los datos del INE revela múltiples dimensiones críticas de esta problemática:

**Inequidades Geográficas y de Acceso:** El análisis de contingencia entre área geográfica (AREAG) y asistencia recibida (ASISREC) muestra una relación estadísticamente significativa (χ² = 110.08, p < 0.001), confirmando que existe una diferencia sustancial en el acceso a servicios de salud entre zonas urbanas y rurales. Las mujeres en áreas rurales enfrentan mayores barreras para recibir atención prenatal adecuada, lo que se traduce en mayor riesgo de complicaciones y desenlaces adversos. Adicionalmente, el 30.5% de los registros (12,695 casos) carecen de información sobre el área geográfica, sugiriendo problemas en la recopilación de datos en zonas remotas donde precisamente se requiere mayor vigilancia epidemiológica.

**Calidad y Completitud de la Información:** El dataset presenta deficiencias importantes en la captura de información. Variables críticas como grupo étnico materno (GRETNM) tienen 68.69% de datos faltantes, nacionalidad de la madre (NACIOM) presenta 52.88% de valores ausentes, y ocupación materna (OCUPAM) tiene 68.69% sin información. La presencia sistemática de códigos especiales (999, 9999) en variables como edad de la madre (EDADM) y semanas de gestación (SEMGES) indica problemas en el registro o reportes incompletos por parte de los establecimientos de salud. Esta falta de información completa dificulta la identificación precisa de factores de riesgo y limita la capacidad de diseñar intervenciones específicas y efectivas.

**Factores Sociodemográficos Asociados:** El análisis de correlación revela relaciones significativas entre variables sociodemográficas. Existe una correlación fuerte (r = 0.846) entre el total de hijos tenidos (TOHITE) y el total de hijos vivos (TOHIVI), y una correlación moderada-fuerte (r = 0.743) entre total de hijos tenidos y total de hijos nacidos muertos (TOHINM). Estas correlaciones sugieren que la multiparidad está asociada con mayor riesgo de pérdidas fetales previas, lo cual es consistente con literatura médica que documenta mayor riesgo obstétrico en mujeres con múltiples embarazos. La edad materna también muestra correlación positiva con el número de hijos (r = 0.70), indicando que mujeres de mayor edad con múltiples embarazos constituyen un grupo de particular vulnerabilidad.

**Tendencia Temporal:** El análisis de la serie temporal (2009-2023) muestra variabilidad interanual en el número de defunciones fetales, con una tendencia general de disminución desde aproximadamente 3,400 casos en 2009 hasta 2,325 casos en 2022. Sin embargo, esta reducción no ha sido constante ni uniforme, observándose incrementos en ciertos años que podrían estar relacionados con eventos específicos (desastres naturales, crisis sanitarias, cambios en políticas de salud). Es fundamental investigar estos patrones para entender qué factores han contribuido a las reducciones observadas y qué elementos podrían estar revirtiendo estos avances.

**Diversidad de Causas de Muerte:** El análisis de la variable CAUDEF (causa de defunción) identifica 206 códigos diferentes según la Clasificación Internacional de Enfermedades (CIE-10), evidenciando una alta variabilidad etiológica. Esta diversidad sugiere que no existe una única causa dominante, sino múltiples factores médicos, obstétricos y sociales que contribuyen a la mortalidad fetal. Comprender cuáles son las causas más frecuentes y cómo se distribuyen geográfica y temporalmente es esencial para priorizar intervenciones preventivas y asignar recursos de manera eficiente.

## Implicaciones para la Salud Pública

La mortalidad fetal en Guatemala no es un problema aislado, sino que se inscribe en un contexto más amplio de desigualdades en salud materno-infantil. Los Objetivos de Desarrollo Sostenible (ODS), particularmente el ODS 3 que busca "garantizar una vida sana y promover el bienestar para todos en todas las edades", incluyen metas específicas para reducir la mortalidad neonatal y materna. La mortalidad fetal, aunque no siempre explícitamente incluida en estas métricas, es un indicador proxy crítico de la calidad de la atención prenatal y obstétrica.

Las defunciones fetales tienen costos directos e indirectos significativos: gastos médicos, pérdida de productividad, impacto psicológico en las familias y carga sobre el sistema de salud. Más importante aún, muchas de estas muertes son prevenibles mediante intervenciones conocidas y costo-efectivas: control prenatal adecuado, detección temprana de complicaciones, acceso oportuno a servicios obstétricos de emergencia, educación materna sobre signos de alarma y promoción de prácticas saludables durante el embarazo.

## Justificación de la Investigación

Este estudio es fundamental por tres razones principales:

**Generación de Evidencia Empírica:** Aunque existen estudios internacionales sobre mortalidad fetal, la evidencia específica para Guatemala es limitada. Este análisis proporciona una caracterización comprehensiva basada en datos oficiales del INE que abarca 14 años, permitiendo identificar patrones específicos del contexto guatemalteco que pueden no coincidir con hallazgos de otros países.

**Base para Políticas Públicas:** Los resultados de este análisis pueden orientar la toma de decisiones en salud pública, permitiendo la asignación eficiente de recursos hacia las áreas geográficas, grupos poblacionales y períodos temporales de mayor riesgo. La identificación de factores modificables puede guiar el diseño de intervenciones preventivas específicas.

**Reducción de Inequidades:** Al documentar las disparidades geográficas y sociodemográficas en la mortalidad fetal, este estudio contribuye a visibilizar las inequidades en salud que afectan desproporcionadamente a poblaciones rurales, indígenas y de bajos recursos. Esta evidencia es esencial para abogar por políticas que garanticen acceso equitativo a servicios de salud prenatal de calidad.

---

## Problema Científico

Con base en el contexto descrito, se plantea el siguiente problema de investigación:

**¿Cuáles son los principales factores sociodemográficos, geográficos y de acceso a servicios de salud asociados con la mortalidad fetal en Guatemala durante el período 2009-2023, y cómo se distribuyen espacial y temporalmente estos factores en el territorio nacional?**

Este problema se descompone en las siguientes interrogantes específicas:

- ¿Qué variables sociodemográficas (edad materna, escolaridad, estado civil, etnia, paridad) muestran asociación estadísticamente significativa con la mortalidad fetal?
- ¿Existen diferencias significativas en las tasas de mortalidad fetal entre áreas urbanas y rurales, y cómo se relacionan estas diferencias con el acceso a asistencia médica?
- ¿Qué departamentos y municipios presentan las tasas más elevadas de mortalidad fetal y qué características comunes comparten?
- ¿Cómo ha evolucionado la mortalidad fetal a lo largo del período 2009-2023 y qué patrones temporales o estacionales son identificables?
- ¿Es posible identificar perfiles o clusters de casos con características similares que permitan clasificar poblaciones de alto riesgo?

---

## Objetivos de la Investigación

### Objetivo General

Identificar, cuantificar y analizar los factores determinantes de la mortalidad fetal en Guatemala durante el período 2009-2023, mediante técnicas de análisis exploratorio de datos, estadística inferencial y clustering, con el propósito de comprender los patrones de distribución geográfica, temporal y sociodemográfica que permitan orientar el diseño de políticas públicas y programas de salud materno-infantil basados en evidencia.

### Objetivos Específicos

**1. Caracterizar la relación entre factores sociodemográficos y mortalidad fetal**

Determinar y cuantificar la relación entre variables sociodemográficas maternas (edad en años, nivel de escolaridad, estado civil, grupo étnico, ocupación) y la incidencia de defunciones fetales, mediante análisis de correlación, pruebas de asociación estadística y regresión, para identificar cuáles factores son predictores significativos de mayor riesgo.

**2. Evaluar disparidades geográficas en acceso a servicios de salud**

Comparar las tasas de mortalidad fetal entre áreas urbanas y rurales (variable AREAG), analizando las diferencias en acceso a asistencia médica durante el parto (ASISREC), sitio de ocurrencia (SITIOOCU) y otras variables de atención, utilizando tablas de contingencia y pruebas de independencia Chi-cuadrado para cuantificar las inequidades en cobertura de servicios de salud prenatal y obstétrica.

**3. Identificar zonas geográficas de alto riesgo**

Realizar un análisis geoespacial descriptivo de las defunciones fetales por departamento (DEPREG, DEPREM) y municipio (MUPREG, MUPREM) para identificar las áreas geográficas con mayor incidencia absoluta y relativa, elaborando mapas de riesgo que permitan priorizar intervenciones y asignación de recursos en salud pública.

**4. Analizar tendencias y patrones temporales**

Examinar la evolución temporal de las defunciones fetales durante el período 2009-2023 (variables AÑOREG, MESREG), identificando tendencias de largo plazo, variaciones interanuales, posibles patrones estacionales y cambios en la distribución de causas principales de muerte fetal (CAUDEF), con el objetivo de detectar períodos críticos y evaluar el impacto de posibles intervenciones históricas.

**5. Clasificar perfiles de riesgo mediante análisis de clustering**

Aplicar técnicas de aprendizaje automático no supervisado (clustering jerárquico o k-means) para agrupar casos de mortalidad fetal con características similares en cuanto a edad materna, semanas de gestación, área geográfica, acceso a servicios y otras variables relevantes, permitiendo la identificación de poblaciones vulnerables específicas y la personalización de estrategias preventivas según perfil de riesgo.

---

## Alcances y Limitaciones

**Alcances:**

Este estudio cubre el período 2009-2023 con datos oficiales del INE, abarcando todo el territorio nacional guatemalteco. El análisis incluye 33 variables que permiten caracterizar aspectos sociodemográficos, geográficos, temporales y clínicos de las defunciones fetales. Los resultados serán generalizables a nivel nacional y podrán desagregarse por departamento y municipio.

**Limitaciones:**

La principal limitación es la alta proporción de datos faltantes en algunas variables críticas (>50% en GRETNM, NACIOM, OCUPAM), lo que puede limitar ciertos análisis multivariados. Adicionalmente, el dataset no incluye información sobre nivel socioeconómico, índice de desarrollo humano municipal, o distancia a servicios de salud, variables que podrían ser relevantes. Finalmente, el análisis es de naturaleza observacional y descriptiva, por lo que las asociaciones identificadas no implican necesariamente causalidad.

---

# Conclusiones

::: {.alert .alert-info}
## Hallazgos Principales

### 1. Disparidad Geográfica y Acceso a la Salud

El análisis evidenció una marcada brecha en la asistencia médica recibida, estrechamente ligada al entorno geográfico y al sitio de ocurrencia de los hechos.

Se concluye que las áreas rurales de Guatemala presentan una dependencia estructural de la asistencia no profesional, como las comadronas, lo que refleja una centralización de los servicios de salud especializados en zonas urbanas y pone de manifiesto la necesidad de fortalecer la infraestructura hospitalaria periférica para reducir los riesgos asociados a los partos fuera de instituciones médicas.

### 2. El Impacto del Nivel Educativo en la Fecundidad

Se determinó que el nivel educativo de la madre es el predictor socioeconómico más influyente sobre el comportamiento de la fecundidad en la población estudiada.

A través de las correlaciones negativas observadas entre la escolaridad y el total de hijos, se concluye que el acceso a la educación formal actúa como un factor determinante para la planificación familiar; a mayor preparación académica, se observa una tendencia clara hacia la reducción del tamaño de las familias y la postergación de la maternidad en los registros analizados.

### 3. Dinámica Demográfica de la Edad Materna

La investigación permitió validar la relación biológica y demográfica existente entre la edad de la madre y su descendencia total.

Se concluye que existe una correlación positiva moderada que confirma que, a medida que aumenta la edad, se incrementa el número de hijos nacidos vivos; sin embargo, la presencia de valores atípicos en edades tempranas con paridad elevada sugiere condiciones de vulnerabilidad social que deben ser abordadas desde una perspectiva de políticas públicas de salud reproductiva.

### 4. Estacionalidad y Gestión de Recursos Vitales

Los hallazgos sobre la distribución temporal de los registros confirman la existencia de una estacionalidad en las estadísticas vitales del país, identificando meses específicos con mayor saturación de registros.

Esta conclusión es fundamental para la gestión operativa del sistema de salud y del registro civil, ya que permite anticipar los periodos de mayor demanda y optimizar la asignación de personal y suministros médicos durante las épocas del año que históricamente concentran el mayor flujo de eventos.

### 5. Validación de Perfiles mediante Clustering

La aplicación de técnicas de agrupamiento permitió identificar tres perfiles poblacionales con características socio-biológicas claramente diferenciadas, lo que fue validado técnicamente mediante el método de la silueta.

Se concluye que el clustering es una herramienta potente para segmentar la población en grupos como el de "Alta Vulnerabilidad" (baja escolaridad y alta fecundidad), permitiendo que los siguientes pasos de minería de datos se enfoquen en modelos predictivos específicos para cada segmento identificado.

### Recomendaciones para Análisis Posteriores

1.  **Limpieza de datos**: Convertir códigos especiales (999, 9999, 99) a valores NA
2.  **Transformaciones**: Considerar transformación logarítmica para variables con sesgo pronunciado
3.  **Análisis multivariado**: Explorar modelos de regresión para relaciones más complejas
4.  **Análisis geoespacial**: Investigar patrones regionales por departamento y municipio
5.  **Series temporales**: Analizar tendencias y estacionalidad en los datos
6.  **Análisis de supervivencia**: Estudiar factores asociados con causas de defunción
:::

------------------------------------------------------------------------

# Información de Sesión

```{r session-info}
sessionInfo()
```

------------------------------------------------------------------------

::: {.alert .alert-success style="text-align: center;"}
**Fin del Análisis Exploratorio**

Documento generado el `r format(Sys.time(), '%d de %B de %Y a las %H:%M:%S')`
:::
